<div ng-include src="'./inv_subnav.html'"></div>
<div class="container" style="min-width:620px; max-width:880px">

  <div style="width:100%; margin-top:24px; padding-bottom:6px; font-size:1.6em; border-bottom:solid 1px #dddddd">
    <img src="images/inv_box.png" height="36" width="36" style="vertical-align:top"/>
    <div style="display: inline-block; vertical-align:top; margin-top:2px; margin-left:2px">In-Storage Inventory</div>
  </div>
  <div class="hint_text" style="width:100%; padding-top:4px;">
    Record inventory by physical storage locations.
  </div>

  <!-- ADD LOCATION UI -->
  <div ng-show="show_add_loc_ui===true || locations.length===0" class="add_ui_box_blue" style="margin-top:16px; max-width:640px; margin-bottom:-8px">
    <div class="add_title_bar_blue">
      <button ng-if="locations.length>0" ng-click="hideAddLoc()" type="button" class="btn btn-default btn_x" style="float:left">
        <span class="glyphicon glyphicon-remove" aria-hidden="true"></span>
      </button>
      <div class="add_title_blue">
        <span style="font-size:1.0em;"> Add New Location</span>
      </div>
      <br/>
    </div>
    <div class="row" ng-if="locations.length===0" style="padding-left:30px; margin-top:10px; font-size:1.1em">
      We track inventory by storage Locations.  &nbsp;Let's create one to get started!
    </div>
    <new-location all-locations="locations" loc-type="k_loc_type" control="newLocControl" close-on-save="newLocationCloseOnSave(new_loc)"></new-location>
  </div>

  <div ng-if="locations.length>0" style="margin-top:24px; margin-bottom:24px">
    <div class="row">
      <div class="col-xs-6">
        <span style="float:left">
          <div class="btn-group" dropdown>
            <button type="button" class="btn btn-default btn-sm dropdown-toggle loc_dropdown" dropdown-toggle style="font-size:1.2em">
              <span ng-if="selected_loc !== null" style="float:left; text-align:left; width:90%">
                {{selected_loc.name}} 
              </span>
              <span ng-if="selected_loc === null" class="noselect" style="float:left; text-align:left; width:90%">
                Select a Location
              </span>
              <span class="glyphicon glyphicon-triangle-bottom" style="text-align:right; margin-top:4px; font-size:14px; color:#888888"></span>
            </button>
            <ul class="loc_dropdown dropdown-menu" role="menu">
              <li class="loc_li" ng-repeat="loc in locations">
                <a ng-click="selectLoc(loc)" ng-class="{new_loc: loc.is_add === true}" class="noselect">{{loc.name}}</a>
              </li>
              <li class="loc_li">
                <a ng-click="showAddLocation()" class="new_loc noselect">+ New Location</a>
              </li>
            </ul>
          </div>
        </span>
        <span ng-if="selected_loc !== null">
          <button ng-click="toggleEditLoc()" type="button" class="btn btn-default btn-sm" style="font-size:20px; height:37px; float:left; margin-left:8px; color:#b5d9f0; border-color:#dddddd">
            <span class="glyphicon glyphicon-cog" aria-hidden="true"></span>
          </button>
        </span>
      </div>
      <div ng-if="last_update !== null" class="col-xs-6" style="text-align:right; margin-top:0px;">
        <div style="font-size:1.1em">Total Inventory: ${{total_inventory | number:2}}</div>
        <div class="hint_text">Last Counted: {{last_update}}</div>
      </div>
    </div>
  </div>

  <div ng-if="selected_loc!==null && edit_loc===true" class="add_ui_box_blue" style="margin-top:-12px; margin-bottom:12px; max-width:640px;">
    <div class="add_title_bar_blue">
      <button ng-if="locations.length>0" ng-click="toggleEditLoc()" type="button" class="btn btn-default btn_x" style="float:left">
        <span class="glyphicon glyphicon-remove" aria-hidden="true"></span>
      </button>
      <div class="add_title_blue">
        <span style="font-size:1.0em;">Edit This Location</span>
      </div>
      <br/>
    </div>
    <edit-location all-locations="locations" loc-type="k_loc_type" edit-loc="selected_loc" control="editLocControl" close-on-delete="editLocationCloseOnDelete(delete_loc)"></edit-location>
  </div>

  <!-- ADD NEW INV ITEM HINT WHEN NO ITEMS EXIST ALREADY -->
  <div ng-if="selected_loc!=null && show_add_ui==false">
    <div ng-if="inv_items.length===0">
      <div class="row">
        <div class="col-xs-9" style="font-size:1.1em">
          This Location doesn't have inventory items yet!<br/>Before we can 
          count inventory, add your first inventory item(s). 
        </div>
        <div class="col-xs-3" style="text-align:right">
          <button ng-click="showAddInv()" type="button" class="btn btn-success btn-sm btn_right" style="font-size:14px">
            <span class="glyphicon glyphicon-plus" aria-hidden="true"></span> Inventory
          </button>
        </div>
      </div>
    </div>
  </div>

  <div ng-show="selected_loc!==null && show_add_ui===true" class="add_ui_box_green" style="margin-top:16px">
    <div class="add_title_bar_green">
      <button ng-click="hideAddInv()" type="button" class="btn btn-default btn_x" style="float:left">
        <span class="glyphicon glyphicon-remove" aria-hidden="true"></span>
      </button>
      <div class="add_title_green">
        <span style="font-size:1.0em;"> Add Inventory Items to {{selected_loc.name}} </span>
      </div>
      <br/>
    </div>

    <loc-add-inv loc-name="selected_loc.name" all-beverages="add_inv_existing_bevs" all-kegs="add_inv_existing_kegs" control="addInvControl" add-bev-inv="addInvAddBev(bev)" add-keg-inv="addInvAddKeg(keg)" show-kegs="true" show-tabs="true" list-height="300" brewery-distributor="'both'"></loc-add-inv>

  </div>

  <div ng-if="selected_loc !== null && inv_items.length>0" style="margin-top:36px">
    <div class="row" ng-if="inv_started === false">
      <div class="col-xs-12" style="float:none">
        <button ng-click="promptStartInv()" type="button" class="btn btn-default inv_xl_btn center-block">
          <span class="glyphicon glyphicon-check" aria-hidden="true"></span> Start Counting Inventory
        </button>
      </div>
    </div>

    <div class="row" ng-if="inv_started === true">
      <div class="col-xs-4">
      </div>
      <div class="col-xs-4 min_padding" style="text-align:center">
        <button ng-click="saveInv()" type="button" class="btn btn-success inv_xl_btn_dark" style="padding-right:36px; padding-left:36px;">
          <span class="glyphicon glyphicon-pencil" aria-hidden="true"></span> Finish & Save
        </button>
      </div>
      <div class="col-xs-4 min_padding" style="text-align:right">
        <button ng-click="cancelInv()" type="button" class="btn btn-default btn-md" style="height:54px">
          <span class="glyphicon glyphicon-remove" aria-hidden="true"></span> Discard Changes
        </button>
      </div>
    </div>
  </div>

  <div ng-if="inv_items.length>0 && selected_loc !== null" style="margin-top:16px">

    <div ng-if="inv_started===false" class="row" style="font-size:1.0em">
      <div class="col-xs-12">
        The Quantities below are from the last time you did inventory. <br/>
        To start current inventory, press the <b>Start Counting Inventory</b>
        button above!
      </div>
    </div>

    <div ng-if="inv_started===true">
      <div class="row">
        <div class="col-xs-12" style="text-align:center; font-size:1.2em">
          When you finish counting inventory in this location, don't forget to 
          <b>Finish & Save</b>!
        </div>
      </div>
      <div ng-if="update_failure_msg.length > 0" class="row" style="margin-top:12px; min-height:16px">
        <div class="col-xs-12 center-block alert alert-danger" style="margin-bottom:0px" role="alert">
          {{update_failure_msg}}
        </div>
      </div>
    </div>
  </div>

  <!-- Location inventory -->
  <div ng-if="inv_items.length>0 && inv_items.length>0 && selected_loc !== null" style="margin-top:8px; margin-bottom:128px">
    <div class="row label_row_container">
      <div class="col-xs-3 inv_sort_div" ng-click="sortBy('product')">
        <button ng-if="show_add_ui===false" ng-click="showAddInv()" type="button" class="btn btn-success btn-sm" style="margin-left:-4px; margin-top:-6px; height:32px; font-size:1.0em; position:absolute" onclick="event.preventDefault(); event.stopPropagation();">
          <span class="glyphicon glyphicon-plus" aria-hidden="true"></span>
        </button>
        <span class="inv_loc_label_span noselect" style="padding-left:40px">Product</span>
        <span class="glyphicon inv_sort_carat glyphicon-menu-down noselect" ng-show="sort_key === 'product'" ng-class="{'glyphicon-menu-down': double_sort<0, 'glyphicon-menu-up':double_sort>0}"></span>
      </div>
      <div class="col-xs-3 inv_sort_div" ng-click="sortBy('brewery')">
        <span class="inv_loc_label_span noselect">Brewery / Distributor</span>
        <span class="glyphicon inv_sort_carat glyphicon-menu-down noselect" ng-show="sort_key === 'brewery'" ng-class="{'glyphicon-menu-down': double_sort<0, 'glyphicon-menu-up':double_sort>0}"></span>
      </div>
      <div class="col-xs-2 inv_sort_div" ng-click="sortBy('unit_cost')" ng-if="inv_started===false">
        <span class="inv_loc_label_span noselect" style="padding-top:6px; padding-bottom:6px">Unit Cost</span>
        <span class="glyphicon inv_sort_carat glyphicon-menu-down noselect" ng-show="sort_key === 'unit_cost'" ng-class="{'glyphicon-menu-down': double_sort<0, 'glyphicon-menu-up':double_sort>0}"></span>
      </div>
      <div class="col-xs-1 inv_sort_div" ng-click="sortBy('quantity')" ng-if="inv_started===false">
        <span class="inv_loc_label_span noselect" style="padding-top:6px; padding-bottom:6px">Qty</span>
        <span class="glyphicon inv_sort_carat glyphicon-menu-down noselect" ng-show="sort_key === 'quantity'" ng-class="{'glyphicon-menu-down': double_sort<0, 'glyphicon-menu-up':double_sort>0}"></span>
      </div>
      <div class="col-xs-5 inv_sort_div" ng-click="sortBy('quantity')" ng-if="inv_started===true">
        <span class="inv_loc_label_span noselect" style="padding-top:6px; padding-bottom:6px">Quantity</span>
        <span class="glyphicon inv_sort_carat glyphicon-menu-down noselect" ng-show="sort_key === 'quantity'" ng-class="{'glyphicon-menu-down': double_sort<0, 'glyphicon-menu-up':double_sort>0}"></span>
      </div>

      <div class="col-xs-2 inv_sort_div" ng-click="sortBy('inventory')" ng-if="inv_started===false" popover="Inventory = Quantity * Unit Cost + Deposit.  The cost of beverages can be edited in the All Beverages DB." popover-trigger="mouseenter" popover-append-to-body="true" popover-popup-delay="500">
        <span class="inv_loc_label_span noselect" style="padding-top:6px; padding-bottom:6px">Inventory</span>
        <span class="glyphicon inv_sort_carat glyphicon-menu-down noselect"ng-show="sort_key === 'inventory'" ng-class="{'glyphicon-menu-down': double_sort<0, 'glyphicon-menu-up':double_sort>0}"></span>
      </div>
      <!--div class="col-xs-3" style="text-align:right">Update Item</div-->
    </div>
    <div ng-repeat="inv in inv_items">
      <div ng-class-even="'row inv_row_container inv_row_even'" ng-class-odd="'row inv_row_container inv_row_odd'">
        <div class="col-xs-3 min_padding" style="padding-top:6px;">
          <!--span ng-if="inv.updated_today==true" class="glyphicon glyphicon-ok-circle check_circle" style="margin-right:6px; float:left; margin-top:-2px;"></span-->
          <div style="font-size:1.1em; padding-left:6px; margin-top:-6px">
            <span ng-if="inv.type==='bev'">
              {{inv.product}}
            </span>
            <span ng-if="inv.type==='keg'">
              <img src="images/inv_keg.png" height="22" width="22" style="vertical-align:top; margin-top:0px"> Keg Deposit
            </span>
          </div>
          <div style="font-size:0.9em; color:#999999; padding-left:6px;"> 
            <!--span ng-if="inv.type==='keg'">{{inv.distributor}}</span-->
            <span ng-if="inv.type==='keg'">Empty </span>
            <span ng-if="inv.purchase_volume!==null">{{inv.purchase_volume | number:1}} {{inv.purchase_unit}}</span>
            <span ng-if="inv.type==='bev'">{{inv.container_type}}</span>
            <span ng-if="inv.type==='keg'">Keg</span>
          </div>
        </div>
        <div class="col-xs-3 min_padding inv_col" style="padding-top:8px">
          <span ng-if="inv.type==='bev'">{{inv.brewery}}</span>
          <span ng-if="inv.type==='keg'">{{inv.distributor}}</span>
        </div>
        <div class="col-xs-2 min_padding" style="padding-top:8px; padding-left:8px !important" ng-if="inv_started===false">
          <div ng-if="inv.type==='bev'">
            <div ng-if="inv.deposit !== null" style="font-size:1.1em; padding-left:6px; margin-top:-6px">$ {{inv.purchase_cost / inv.purchase_count | number:2}}</div>
            <div ng-if="inv.deposit !== null" style="font-size:0.9em; color:#999999; padding-left:6px;"> $ {{inv.deposit | number:2}} Dpst.</div>
            <div ng-if="inv.deposit === null" style="font-size:1.1em; padding-left:2px">$ {{inv.purchase_cost / inv.purchase_count | number:2}}</div>
          </div>
          <div ng-if="inv.type==='keg'">
            <div ng-if="inv.deposit !== null" style="font-size:1.1em; padding-left:6px;">$ {{inv.deposit | number:2}}</div>
          </div>
        </div>
        <div class="min_padding" ng-class="{'col-xs-1': inv_started===false, 'col-xs-6': inv_started===true}">

          <div ng-if="inv_started===false" style="font-size:1.1em; padding-top:8px; padding-left:2px;">
            {{inv.quantity}}
          </div>

          <div ng-if="inv_started===true">
            <button ng-click="addQuantity(inv,-1, false)" type="button" class="btn btn-default inv_minus_btn">
              <span class="glyphicon glyphicon-minus" aria-hidden="true"></span>
            </button>
            <div class="form" ng-class="{'has-error': inv.invalid_quantity===true}">
              <input ng-model="inv.quantity" ng-class="{'input_error': inv.invalid_quantity===true}" class="form-control" style="display:inline-block; float:left; text-align:center; max-width:64px; height:38px; font-size:1.3em;">
            </div>
            
            <button ng-click="addQuantity(inv,1, false)" type="button" class="btn btn-default inv_plus_btn">
            <span class="glyphicon glyphicon-plus" aria-hidden="true"></span>
            </button>
            <button ng-click="addQuantity(inv,inv.add_q, true)" type="button" class="btn btn-default inv_plus_btn" style="margin-left:16px">
              <b>Add:</b>
            </button>
            <div class="form">
              <input ng-model="inv.add_q" class="form-control" style="display:inline-block; float:left; text-align:center; max-width:56px; height:38px; font-size:1.3em;" placeholder="">
            </div>
          </div>
        </div>
        <div ng-if="inv_started===false" class="min_padding col-xs-2">
          <div style="padding-left:4px; padding-top:8px;">
            <span style="vertical-align:top">$ {{inv.inventory | number:2}}</span>
            <span ng-if="inv.out_of_date===true" class="glyphicon glyphicon-exclamation-sign" style="font-size:18px; color:#ffbb22;" popover="This beverage has been updated since its inventory was last saved, and the old inventory value might not reflect its current pricing." popover-trigger="mouseenter" popover-append-to-body="true"></span>
          </div>
        </div>
        <div class="col-xs-1 min_padding" style="padding-top:2px" ng-if="inv_started===false">
          <button ng-click="removeInvItem($index)" type="button" class="btn btn-default btn-sm btn-right" style="font-size:14px; min-height:32px; color:#888888">
            <span class="glyphicon glyphicon-trash" aria-hidden="true" style="color:#aaaaaa"></span>
          </button>
        </div>
      </div>
    </div>
  </div>

</div>

<div ng-include src="'./view_loc/start_count_modal.html'">



