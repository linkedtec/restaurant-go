<div ng-include src="'./purch_subnav.html'"></div>
<div class="container" style="min-width:880px; max-width:880px">

  <div style="width:100%; margin-top:24px; padding-bottom:4px; font-size:1.3em; border-bottom:solid 1px #dddddd">
    <img src="images/inv_delivery.png" height="32" width="32" style="vertical-align:top"/>
    <div style="display: inline-block; vertical-align:top; margin-top:8px; margin-left:2px">Create Purchase Order</div>
  </div>
  <div class="hint_text" style="width:100%; padding-top:2px; font-size:1.0em">
    Create and send new Purchase Orders to Distributors
  </div>

  <div ng-if="showMode===0">
    <div class="row" style="font-size:1.6em; margin-top:48px; text-align:center">
      How would you like to create your new Purchase Order?
    </div>
    <div class="row" style="margin-top:12px">
      <div class="col-xs-1"></div>
      <div class="col-xs-5" style="padding:0px 8px 0px 16px;">
        <div class="clickable_box gray_shadow" style="height:300px" ng-click="setShowMode(1, 'auto')">
          <div style="text-align:center; margin-top:24px; font-size:1.5em; color:#4499cc">
            Automatic / Match Par
          </div>
          <div style="position:absolute; bottom:0; padding:20px">
            <span style="font-size:1.1em">
              Easily bulk order beverages on your menu, using 
              Par minus Inventory.  </br>
            </span>
            <span style="font-style:italic; font-size:1.0em">
              Requires up-to-date <b>Menu Plan</b> and <b>Inventory</b>.</br>
              For more info, <a ng-click="showHelp()" class="help_link">click here</a>.
            </span>
          </div>
        </div>
      </div>
      <div class="col-xs-5" style="padding:0px 16px 0px 8px; cursor:pointer">
        <div class="clickable_box gray_shadow" style="height:300px" ng-click="setShowMode(1, 'manual')">
          <div style="text-align:center; margin-top:24px; font-size:1.5em; color:#4499cc">
            Manual Entry
          </div>
          <div style="text-align:center; margin-top:24px">
            <img src="images/po_manual.png" height="88px" width="88px">
          </div>
          <div style="position:absolute; bottom:0; padding:20px; padding-bottom:30px">
            <span style="font-size:1.1em;">
              Manually build custom Purchase Orders to send to Distributors. 
              Good for ordering one-offs, for example.
            </span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div ng-if="showMode===1" style="margin-top:32px;">
    <div class="row" style="border-bottom:1px solid #e0e0e0; margin:0; margin-bottom:16px;">
      <div class="col-xs-2 help_link" style="font-size:1.4em; margin-top:6px;" ng-click="cancelPurchaseOrder()">
        <span class="glyphicon glyphicon-remove" style="font-size:16px;"></span>
        Cancel
      </div>
      <div class="col-xs-8" style="font-size:1.8em; text-align:center;">
        New Purchase Order
      </div>
    </div>

    <!-- Basic information box, applies to all Distributor Purchase Orders -->
    <div class="gray_shadow po_box" style="padding-bottom:8px">
      <div class="row">
        <div class="col-xs-4" style="font-size:1.4em; color:#999999">
          Basic Information
        </div>
        <div class="col-xs-8" style="text-align:right">
          
          <div class="input-group" style="float:right; width:200px">
            <input type="text" ng-class="{'my_error': form_ver.error_sale_start===true}" class="form-control input_small" uib-datepicker-popup="{{date_format}}" ng-model="new_beverage.sale_start" is-open="date_opened.start" datepicker-options="date_options" ng-required="true" close-text="Close" ng-change="saleStartChanged()">
            <span class="input-group-btn">
              <button type="button" class="btn btn-default input_small" ng-click="openSaleStart($event)"><span class="glyphicon glyphicon-calendar"></span></button>
            </span>
          </div>
          <div style="display:inline-block; float:right; margin-right:6px; font-size:1.2em; color:#999999; margin-top:2px">Order Date: </div>
        </div>
      </div>  

      <hr style="margin:6px 0px"/>
      <div class="row" style="margin-top:16px; padding-left:0px">
        <div class="col-xs-3">
          <div class="form-group" style="margin-bottom:0px" ng-class="{'has-error': form_ver.error_contact===true}">
            <label class="control-label bold label_small"> Restaurant Contact</label>
            <input ng-model="new_order.contact" class="form-control input_small" placeholder="Your name">
          </div>
        </div>
        <div class="col-xs-3">
          <div class="form-group" style="margin-bottom:0px" ng-class="{'has-error': form_ver.error_contact_email===true}">
            <label class="control-label bold label_small"> Restaurant Email</label>
            <input ng-model="new_order.contact_fax" class="form-control input_small" placeholder="Email">
          </div>
        </div>
        <div class="col-xs-3">
          <div class="form-group" style="margin-bottom:0px" ng-class="{'has-error': form_ver.error_contact_phone===true}">
            <label class="control-label optional label_small"> Restaurant Phone</label>
            <input ng-model="new_order.contact_phone" class="form-control input_small" placeholder="Phone number">
          </div>
        </div>
        <div class="col-xs-3">
          <div class="form-group" style="margin-bottom:0px" ng-class="{'has-error': form_ver.error_contact_fax===true}">
            <label class="control-label optional label_small"> Restaurant Fax</label>
            <input ng-model="new_order.contact_fax" class="form-control input_small" placeholder="Fax number">
          </div>
        </div>
      </div>
      <div class="row" style="margin:0; margin-top:8px; text-align:right">
        <input ng-checked="default_contact_checked" type="checkbox" id="cb_default_contact" class="customCbSqr" style="z-index:-99;" ng-click="toggleDefaultContact()"/>
          <label for="cb_default_contact" ng-click="toggleDefaultContact()" style="margin-left:28px"></label>
        <span style="float:right; margin-top:4px; margin-left:6px"> Save changes to default P/O contact info </span>
      </div>
    </div>

    <div ng-repeat='dorder in order.dist_orders' class="gray_shadow po_box" style="padding-bottom:8px; margin-top:16px; position:relative">
      <div style="position:absolute; top:-10px; left:-10px" ng-if="order.dist_orders.length > 1">
        <button ng-click="deleteDistOrder($index)" type="button" class="btn btn-sm btn_x_circle_gray">
          <span class="glyphicon glyphicon-remove" aria-hidden="true"></span>
        </button>
      </div>
      <div class="row">
        <div class="col-xs-6" style="font-size:1.4em; color:#999999">
          Distributor Order
        </div>
        <div class="col-xs-6" style="text-align:right">
          
          <div class="btn-group" style="width:200px !important" uib-dropdown>
            <button type="button" class="btn btn-default btn-md dropdown-toggle" style="width:100%" uib-dropdown-toggle>
              <span ng-if="dorder.distributor !== null" style="float:left; text-align:left; width:90%;">
                {{dorder.distributor.name}} 
              </span>
              <span ng-if="dorder.distributor === null" class="noselect" style="float:left; text-align:left; width:90%;  color:#999999">
                Select a Distributor
              </span>
              <span class="glyphicon glyphicon-triangle-bottom" style="text-align:right; margin-top:4px; font-size:12px; color:#888888"></span>
            </button>
            <ul class="loc_dropdown dropdown-menu" role="menu">
              <li class="inv_dropdown_li" ng-if="new_beverage.distributor!==null">
                <a ng-click="clearDistributor()" class="noselect" style="color:#aaaaaa">None</a>
              </li>
              <li class="inv_dropdown_li" ng-repeat="dist in all_distributors">
                <a ng-click="selectDistributor(dorder, dist)" class="noselect">{{dist.name}}</a>
              </li>
            </ul>
          </div>
        </div>
      </div>  
      <hr style="margin:6px 0px"/>
      <div class="row" ng-if="dorder.distributor === null">
        <div class="col-xs-12" style="text-align:center; font-size:1.6em; color:#cccccc; font-style:italic; padding:24px 0px">
          Please select a Distributor
        </div>
      </div>
      <div class="row" ng-if="dorder.distributor !== null">
        <div class="col-xs-3">
          <div class="form-group" style="margin-bottom:0px" ng-class="{'has-error': form_ver.error_sale_start===true}">
            <label class="control-label label_small"> 
              Est. Delivery Date
            </label>
            <div class="input-group">
              <input type="text" ng-class="{'my_error': form_ver.error_sale_start===true}" class="form-control input_small" uib-datepicker-popup="{{date_format}}" ng-model="new_beverage.sale_start" is-open="date_opened.start" datepicker-options="date_options" ng-required="true" close-text="Close" ng-change="saleStartChanged()">
              <span class="input-group-btn">
                <button type="button" class="btn btn-default input_small" ng-click="openSaleStart($event)"><span class="glyphicon glyphicon-calendar"></span></button>
              </span>
            </div>
          </div>
        </div>
      </div>

      <hr ng-if="dorder.distributor!==null"/>

      <div ng-if="dorder.distributor!==null" style="margin-bottom:32px;">

        <div class="row" style="margin-top:24px">
          <div class="col-xs-4">
            <button ng-show="dorder.show_add_ui===false" ng-click="showAddInv(dorder)" type="button" class="btn btn-success btn-sm" style="font-size:13px; margin-top:-4px">
              <span class="glyphicon glyphicon-plus" aria-hidden="true"></span> Add Beverages
            </button>
          </div>
          <div class="col-xs-4" style="font-size:1.4em; color:#333333; text-align:center;">
            Items in this Order
          </div>
          <div class="col-xs-4" style="text-align:right"></div>
        </div>
        <div class="row" style="margin:0; margin-top:4px;">
          <div ng-if="dorder.show_add_ui===true" class="add_ui_box_green" style="height:480px; margin-bottom:12px">
            <div class="add_title_bar_green">
              <button ng-click="hideAddInv(dorder)" type="button" class="btn btn-default btn_x" style="float:left">
                <span class="glyphicon glyphicon-remove" aria-hidden="true"></span>
              </button>
              <div class="add_title_green">
                <span style="font-size:1.0em;"> Add Beverages to Purchase Order </span>
              </div>
              <br/>
            </div>
            <div style="display:block; position:relative; bottom:0; top:12px; left: 0; right:0; margin:0px; padding:4px 8px; padding-bottom:12px; height:420px">
              <addable-inv all-bevs="dorder.addable_items" all-kegs="[]" added-items="dorder.items" show-tabs="false" show-purchase="true" use-override-add-func="true" override-add-func="addItem(dorder, item)" control="dorder.addableControl"></addable-inv>
            </div>
          </div>
        </div>
        <div class="row" style="margin: 0px 0px; margin-top:0px; font-size:1.0em; color:#777777; padding-bottom:0px; background-color:#f0f0f0; border-top:1px solid #e0e0e0; border-bottom:1px solid #e0e0e0">
          <div class="col-xs-4 add_inv_sort_div_lt min_padding" ng-click="sortDistOrderBevs(dorder, 'product')">
            Product / Brewery
            <span class="glyphicon inv_sort_carat glyphicon-menu-down noselect" ng-show="dorder.sort_key === 'product'" ng-class="{'glyphicon-menu-down': dorder.double_sort<0, 'glyphicon-menu-up':dorder.double_sort>0}" style="color:#cccccc;">
            </span>
          </div>
          <div class="col-xs-2 add_inv_sort_div_lt min_padding" ng-click="sortKegsBy('purchase_cost')">
            Unit Cost
            <span class="glyphicon inv_sort_carat glyphicon-menu-down noselect" ng-show="dorder.sort_key === 'purchase_cost'" ng-class="{'glyphicon-menu-down': dorder.double_sort<0, 'glyphicon-menu-up':dorder.double_sort>0}" style="color:#cccccc;">
            </span>
          </div>
          <div class="col-xs-2 add_inv_sort_div_lt min_padding" ng-click="sortBevsBy('par')" style="padding-left:0px">
            Inv / Par
            <span class="glyphicon inv_sort_carat glyphicon-menu-down noselect" ng-show="dorder.sort_key === 'par'" ng-class="{'glyphicon-menu-down': dorder.double_sort<0, 'glyphicon-menu-up': dorder.double_sort>0}" style="color:#cccccc;">
            </span>
          </div>
          <div class="col-xs-2 add_inv_sort_div_lt_nosort noselect min_padding" style="padding-left:12px">
            Quantity
          </div>
          <div class="col-xs-2 add_inv_sort_div_lt min_padding" ng-click="sortBevsBy('subtotal')" style="padding-left:0px">
            Subtotal
            <span class="glyphicon inv_sort_carat glyphicon-menu-down noselect" ng-show="dorder.sort_key === 'subtotal'" ng-class="{'glyphicon-menu-down': dorder.double_sort<0, 'glyphicon-menu-up': dorder.double_sort>0}" style="color:#cccccc;">
            </span>
          </div>
          <div class="col-xs-1 add_inv_sort_div_lt_nosort noselect" style="padding-left:0px"></div>
        </div>
        <hr style="margin:0 0;"/>
        <div ng-if="dorder.items.length === 0" style="text-align:center; color:#cccccc; background-color: #ffffff; font-style:italic; padding:24px 0px; margin-bottom:12px">
          <div style="font-size:1.8em">No Beverages added yet</div>
          <div style="font-size:1.2em; margin-top:6px">Use the "Add Beverages" button to add items to this Order</div>
        </div>
        <div ng-if="dorder.items.length > 0" ng-repeat="item in dorder.items" class="row" ng-class-even="'inv_row_even'" ng-class-odd="'inv_row_odd'" style="padding:6px 0px; margin:0px 2px;">
          <div class="col-xs-4 min_padding">
            <div style="display:inline-block; float:left">
              <img ng-if="item.icon==='draft'" src="images/bev_draft.png" height="34px" width="34px" style="margin-left:0px">
              <img ng-if="item.icon==='wine'" src="images/bev_wine.png" height="34px" width="34px" style="margin-left:0px">
              <img ng-if="item.icon==='bottle'" src="images/bev_bottle.png" height="34px" width="34px" style="margin-left:0px">
              <img ng-if="item.icon==='can'" src="images/bev_can.png" height="34px" width="34px" style="margin-left:0px">
              <img ng-if="item.icon==='liquor'" src="images/bev_xo.png" height="34px" width="34px" style="margin-left:0px">
            </div>
            <div style="display:inline-block; float:left; margin-left:6px">
              <div>{{item.product}}</div>
              <div style="font-size:0.9em; color:#999999">{{item.brewery}}</div>
            </div>
          </div>
          <div class="col-xs-2 min_padding">
            <div><span ng-if="item.purchase_cost!==null" style="color:#999999">$ </span>{{item.purchase_cost | number:2}}</div>
            <div style="font-size:0.9em; color:#999999">
              <span ng-if="item.purchase_unit!==null">
                {{item.purchase_volume | number:1}} {{item.purchase_unit}}
              </span>
              <span>
                {{item.container_type}}
              </span>
            </div>
          </div>
          <div class="col-xs-2 min_padding">
            {{item.count | number:1}} / {{item.par | number:1}}
          </div>
          <div class="col-xs-2">
            <input ng-model="item.quantity" class="form-control input_small" style="max-width:80px" placeholder="">
          </div>
          <div class="col-xs-2 min_padding">
            --
            <div style="float:right">
              <a tabindex="0" popover-trigger="focus" type="button" ng-model="item" uib-popover-template="'popoverRemoveItem.html'" popover-placement="left" popover-title="Remove from list?" popover-append-to-body="true" type="button" class="btn btn-sm btn_frameless hover_red" style="font-size:20px; float:right; padding:0;">
                <span class="glyphicon glyphicon-remove" aria-hidden="true"></span>
              </a>
            </div>
          </div>
          
        </div>

      </div>
    </div>
  </div>

  <div ng-if="showMode===1" class="gray_shadow po_box po_add_box" style="margin-top:16px; margin-bottom:256px" ng-click="addDistributorOrder()">
    <span class="glyphicon glyphicon-plus"></span> Add another Distributor Order
  </div>






</div>

<div ng-include src="'./view_loc/popover_remove_item.html'">






